<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Anki Cards</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header -->
  <div class="app-header" id="appHeader">
    <button class="lang-selector" id="langSelector" onclick="toggleLangDropdown()">
      <span id="langSelectorText">Select Language</span>
      <span class="lang-selector-arrow">&#9660;</span>
    </button>
    <button class="settings-btn" onclick="showScreen('settingsScreen')">&#9881;</button>
    <!-- Language pair dropdown -->
    <div class="lp-dropdown" id="lpDropdown"></div>
  </div>

  <!-- Home Screen -->
  <div id="homeScreen" class="screen active">
    <div class="home-header">
      <h1>Anki Cards</h1>
      <p class="home-subtitle">Learn vocabulary with spaced repetition</p>
    </div>

    <div id="dueBadge" class="due-badge hidden">
      <span id="dueCount">0</span> cards due
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="statTotal">0</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statDue">0</div>
        <div class="stat-label">Due</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statMastered">0</div>
        <div class="stat-label">Mastered</div>
      </div>
    </div>

    <div class="action-buttons">
      <button class="btn btn-primary btn-large" onclick="startReview()">
        <span>Start Review</span>
      </button>
      <button class="btn btn-secondary" onclick="showScreen('importScreen')">
        <span>Import CSV</span>
      </button>
      <button class="btn btn-secondary" onclick="showScreen('exportScreen')">
        <span>Export Backup</span>
      </button>
    </div>
  </div>

  <!-- Review Screen -->
  <div id="reviewScreen" class="screen">
    <div class="progress-bar">
      <div id="progressFill" class="progress-fill"></div>
    </div>
    <div class="progress-text">
      <span id="reviewCurrent">1</span> / <span id="reviewTotal">0</span>
    </div>

    <div class="review-container">
      <div class="card-container" id="cardContainer">
        <div class="swipe-indicators left">&#128260;</div>
        <div class="swipe-indicators right">&#9989;</div>
        <div id="flashcard" class="flashcard" onclick="flipCard()">
          <div class="card-face card-front">
            <div class="card-word" id="cardWord">Word</div>
            <img class="card-image hidden" id="cardImage" src="" alt="">
          </div>
          <div class="card-face card-back">
            <div class="card-translation" id="cardTranslation">Translation</div>
            <p class="card-example hidden" id="cardExample"></p>
            <span class="card-pronunciation hidden" id="cardPronunciation"></span>
          </div>
        </div>
      </div>

      <div class="tap-hint" id="tapHint">Tap card to flip</div>

      <div class="swipe-hint">
        <div class="swipe-hint-item">
          <span>&#128072;</span>
          <span>Swipe left = repeat</span>
        </div>
        <div class="swipe-hint-item">
          <span>Swipe right = good</span>
          <span>&#128073;</span>
        </div>
      </div>

      <div class="rating-buttons" id="ratingButtons">
        <button class="rate-btn again" onclick="rateCard(0)">
          Again
          <span class="rate-btn-label">&lt;1d</span>
        </button>
        <button class="rate-btn hard" onclick="rateCard(1)">
          Hard
          <span class="rate-btn-label">1d</span>
        </button>
        <button class="rate-btn good" onclick="rateCard(2)">
          Good
          <span class="rate-btn-label">3d</span>
        </button>
        <button class="rate-btn easy" onclick="rateCard(3)">
          Easy
          <span class="rate-btn-label">7d+</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Add Card Screen -->
  <div id="addCardScreen" class="screen">
    <h2 class="screen-title">Add New Card</h2>
    <form id="addCardForm">
      <div class="form-group">
        <label class="form-label">Word *</label>
        <input type="text" class="form-input" id="inputWord" placeholder="Foreign word" required>
      </div>
      <div class="form-group">
        <label class="form-label">Translation *</label>
        <input type="text" class="form-input" id="inputTranslation" placeholder="Translation" required>
      </div>
      <div class="form-group">
        <label class="form-label">Example sentence</label>
        <textarea class="form-textarea" id="inputExample" placeholder="Example sentence"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">Pronunciation</label>
        <input type="text" class="form-input" id="inputPronunciation" placeholder="Pronunciation / IPA">
      </div>
      <div class="form-group">
        <label class="form-label">Image URL</label>
        <input type="url" class="form-input" id="inputImageUrl" placeholder="https://...">
      </div>
      <button type="submit" class="btn btn-primary" style="width:100%;">Save Card</button>
    </form>
  </div>

  <!-- Card List Screen -->
  <div id="cardListScreen" class="screen">
    <h2 class="screen-title">My Cards</h2>
    <div id="cardList" class="card-list"></div>
    <div id="emptyCardList" class="empty-state hidden">
      <div class="empty-icon">&#128237;</div>
      <div class="empty-title">No cards yet</div>
      <div class="empty-text">Add your first card to start learning!</div>
      <button class="btn btn-primary" onclick="showScreen('addCardScreen')">Add Card</button>
    </div>
  </div>

  <!-- Import Screen -->
  <div id="importScreen" class="screen">
    <h2 class="screen-title">Import CSV</h2>
    <p style="color: var(--tg-theme-hint-color); margin-bottom: 16px; font-size: 14px;">
      CSV format: word, translation, example, pronunciation, imageUrl<br>
      First row must be the header.
    </p>
    <input type="file" id="csvFileInput" accept=".csv,.txt" class="hidden">
    <button class="btn btn-primary" onclick="document.getElementById('csvFileInput').click()">
      Choose CSV File
    </button>
    <div id="importPreview" class="import-preview hidden">
      <div class="count" id="importCount">0</div>
      <div>cards found</div>
      <button class="btn btn-primary mt-16" onclick="confirmImport()">Import All</button>
    </div>
    <div id="importResult" class="import-result hidden"></div>
  </div>

  <!-- Export Screen -->
  <div id="exportScreen" class="screen">
    <h2 class="screen-title">Export Backup</h2>
    <p style="color: var(--tg-theme-hint-color); margin-bottom: 20px; font-size: 14px;">
      Download all your cards and settings as a JSON file.
    </p>
    <div class="action-buttons">
      <button class="btn btn-primary" onclick="exportDownload()">Download JSON</button>
      <button class="btn btn-secondary" onclick="exportToChat()">Send to Chat</button>
    </div>
    <div id="exportStatus" class="import-result hidden mt-16"></div>
  </div>

  <!-- Settings Screen -->
  <div id="settingsScreen" class="screen">
    <h2 class="screen-title">Settings</h2>

    <div class="settings-section">
      <div class="settings-section-title">Daily Reminder</div>
      <div class="settings-row">
        <span class="settings-row-label">Enabled</span>
        <button class="toggle" id="toggleReminder" onclick="toggleReminder()"></button>
      </div>
      <div class="settings-row" id="reminderTimeRow">
        <span class="settings-row-label">Time</span>
        <div class="time-input">
          <select id="reminderHour"></select>
          <span>:</span>
          <select id="reminderMinute"></select>
        </div>
      </div>
      <div class="settings-row">
        <span class="settings-row-label">Timezone</span>
        <select id="timezoneSelect" class="form-select" style="width: auto; max-width: 180px; padding: 8px;"></select>
      </div>
    </div>

    <div class="settings-section">
      <div class="settings-section-title">Language Pairs</div>
      <div id="settingsLpList"></div>
      <button class="btn btn-secondary btn-small mt-10" onclick="openAddPairModal()">+ Add Language Pair</button>
    </div>

    <button class="btn btn-primary mt-16" onclick="saveSettings()">Save Settings</button>
  </div>

  <!-- Review Complete Screen -->
  <div id="completeScreen" class="screen">
    <div class="complete-content">
      <div class="complete-icon">&#127881;</div>
      <div class="complete-title">Session Complete!</div>
      <div class="complete-stats">
        <div class="complete-stat">
          <span>Reviewed:</span>
          <span class="complete-stat-value" id="statsReviewed">0</span>
        </div>
        <div class="complete-stat">
          <span>Again:</span>
          <span class="complete-stat-value" id="statsAgain">0</span>
        </div>
        <div class="complete-stat">
          <span>Good/Easy:</span>
          <span class="complete-stat-value" id="statsGood">0</span>
        </div>
      </div>
      <button class="btn btn-primary" onclick="showScreen('homeScreen')">Back to Home</button>
    </div>
  </div>

  <!-- Add Language Pair Modal -->
  <div class="modal-overlay" id="addPairModal">
    <div class="modal">
      <div class="modal-title">Add Language Pair</div>
      <form id="addPairForm">
        <div class="form-group">
          <label class="form-label">Source Language</label>
          <input type="text" class="form-input" id="inputSourceLang" placeholder="e.g., Italian" required>
        </div>
        <div class="form-group">
          <label class="form-label">Target Language</label>
          <input type="text" class="form-input" id="inputTargetLang" placeholder="e.g., Russian" required>
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;">Add Pair</button>
        <button type="button" class="btn btn-secondary mt-10" style="width:100%;" onclick="closeAddPairModal()">Cancel</button>
      </form>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav" id="bottomNav">
    <button class="nav-tab active" data-screen="homeScreen" onclick="navTo('homeScreen')">
      <span class="nav-tab-icon">&#128218;</span>
      <span>Review</span>
    </button>
    <button class="nav-tab" data-screen="addCardScreen" onclick="navTo('addCardScreen')">
      <span class="nav-tab-icon">&#10133;</span>
      <span>Add</span>
    </button>
    <button class="nav-tab" data-screen="cardListScreen" onclick="navTo('cardListScreen')">
      <span class="nav-tab-icon">&#128203;</span>
      <span>Cards</span>
    </button>
  </div>

  <script src="app.js"></script>
</body>
</html>
